---
title: "Gráficas de variables"
output:
  word_document: default
  html_notebook: default
---

Buscando programas en librería

```{r}
library(dplyr)
library(ggplot2)
library(tidyr)
```

Ahora abrir las bases de datos. 
Recordar estar en brechgenero para que corra dicx_ile

```{r}
ile <- curso.feminismo.datos::ile_data
dicx_ile <- read.csv("diccionario-de-datos-ile.csv")
View(dicx_ile)
```

Variables que voy a ocupar. 

```{r}
#demograficas
edocivil_descripcion #puente#
edad
nivel_edu
ocupacion
#reproductivos
nhijos
anticonceptivo
```

GRÁFICA DE EDAD
Título "Edad de mujeres que obtaron por una ILE, 2021"
Divida en una secuencia de 10*10
```{r}
ile %>%
  drop_na(edad) %>% 
  ggplot(aes(x = edad)) + 
  geom_histogram(aes(y =..density..), breaks = seq(10, 55, by = 1), 
                 color = "#88398A", fill = "#88398A", alpha = 0.8) +
  geom_density(alpha = 0.5, color = "#D3D3D3", fill = "#D3D3D3") +
  geom_vline(aes(xintercept = mean(edad)), color = "#D3D3D3",
             linetype = "dashed", size = 1) +
  labs(title = "Edad de mujeres que optaron por una ILE, 2016-2020", x= "Edad", y = "Density") +
  theme_classic()
```

Gráfico de densidad para edad 
Si salió
```{r}
ggplot(ile, aes(x = edad)) +
  geom_density() +
  scale_y_continuous("Densidad") +
  scale_x_continuous("Edad") +
  labs(title = "Histograma de densidad 2",
       subtitle = "Forma de la distribución de la variable edad")
```

Nueva gráfica
```{r}
ggplot(ile, aes(x = edad)) +
  geom_bar(width = 0.4, fill=rgb(0.1,0.3,0.5,0.7), aes(y = (..count..)/sum(..count..))) +
  scale_x_discrete("edad") +     # configuración eje X (etiqueta del eje)
  scale_y_continuous("Porcentaje",labels=scales::percent) + #Configuración eje y
  labs(title = "Gráfico de barras 3",
       subtitle = "Frecuencia relativa de la variable edad")
```

```{r}
# Dummy data
ggplot(ile, aes(x =edad)) +
  boxplot(width = 0.4, fill=rgb(0.1,0.3,0.5,0.7), aes(y = (..count..)/sum(..count..))) +
  scale_x_discrete("edad") +     # configuración eje X (etiqueta del eje)
  scale_y_continuous("Porcentaje",labels=scales::percent) + #Configuración eje y
  labs(title = "Gráfico de barras 3",
       subtitle = "Frecuencia relativa de la variable edad")


```


######GRÁFICA DE NIVEL EDUCATIVO#############
con este comando abreviaré el nombre de las variables. 
No olvidar -- No dejar espacios en los nombres que están dentro de las comillas.
En la consola ver unique(ile$nivel_edu2) de esta forma ovy a ver si las varriables en efecto se convietieron. 
***Desde aquí está el error en NA Porque no se convierte a "no constest".

```{r}
ile <- ile %>% 
 mutate(nivel_edu2 = case_when(
    nivel_edu == "LICENCIATURA" ~ "superior",
    nivel_edu == "PREPARATORIA" ~ "media superior",
    nivel_edu == "SECUNDARIA" ~ "b?sica", 
    nivel_edu == "PRIMARIA" ~ "b?sica",
    nivel_edu == "MAESTRIA" ~ "superior", 
    nivel_edu== "DOCTORADO" ~ "superior", 
    nivel_edu== "SIN ACCESO A LA EDUCACION FORMAL" ~ "ninguna"
    )) 
```


```{r}
boxplot(ile$edad)
hist(ile$edad)
```          
          
          
Sacar el porcentaje aparte porque es una variable escrita en texto. 
Es nivel_edu2 porque el nombre de las variables ya están abreviadas. 

```{r}
ile %>% 
  select(nivel_edu2) %>% 
   count(nivel_edu2) %>% 
  mutate(perc = n / nrow(ile)) -> ile_edu
```

Plot con gráficos iluminados "Dark2"
```{r}
ggplot(ile_edu, aes(nivel_edu2, perc, fill = nivel_edu2)) +
  geom_col() + 
  scale_fill_brewer(palette="Dark2") +
  ylab("relative frequencies") + labs(title = "Porcentaje de nivel educativo en mujeres usuarias de ILE") +
  theme_classic() 
```


Plot con gráficos iluminanos de forma manual. 
OJO -- Aquí seleccioné un color para "no contes" o NA
```{r}
ggplot(ile_edu, aes(nivel_edu2, perc, fill = nivel_edu2)) +
  geom_col() + 
  scale_fill_manual(values = c("b?sica" = "#cb997e",
                               "media superior" = "#ddbea9",
                               "superior" = "#ffe8d6",
                               "ninguna" = "#b7b7a4",
                               "NA" = "#a5a58d")) +
  ylab("relative frequencies") + labs(title = "Porcentaje de nivel educativo en mujeres usuarias de ILE") +
  theme_classic() 
```

Plot con gráficos iluminanos de forma manual. 
OJO -- Aquí seleccioné un color para "no contes" o NA
##2intento
```{r}
ggplot(ile_edu, aes(nivel_edu2, perc, fill = nivel_edu2)) +
  geom_col() + 
  scale_fill_manual(values = c("b?sica" = "#cb997e",
                               "media superior" = "#ddbea9",
                               "superior" = "#ffe8d6",
                               "ninguna" = "#b7b7a4"),
                               na.value = "#a5a58d") +
  ylab("relative frequencies") + labs(title = "Porcentaje de nivel educativo en mujeres usuarias de ILE") +
  theme_classic() 
```

Comando que saque de "no abrir brechagenero 10022021"
Aquí si sale los NA 
EJEMPLO EDGAR
```{r}
ggplot(ile_edu, aes(x=nivel_edu2, y = nivel_edu2, fill= nivel_edu2)) +
  geom_col()  +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1), legend.position = "none")
```

Si lee los NA
La leyenda se acomodó por orden alfabetico, ¿Cómo lo ordeno por escolaridad?
```{r}
ggplot(ile, aes(x = nivel_edu2)) +
  geom_bar(width = 0.4, fill=rgb(0.1,0.3,0.5,0.7), aes(y = (..count..)/sum(..count..))) +
  scale_x_discrete("escolaridad") +     # configuración eje X (etiqueta del eje)
  scale_y_continuous("Porcentaje",labels=scales::percent) + #Configuración eje y
  labs(title = "Escolaridad usuarias de ILE",
       subtitle = "Frecuencia relativa de la variable escolaridad")

```

############edocivil_descripcion##########

con este comando abreviaré el nombre de las variables. 
No olvidar -- No dejar espacios en los nombres que están dentro de las comillas.
En la consola ver unique(ile$edocivil_descripcion) de esta forma ovy a ver si las varriables en efecto se convietieron. 
***Desde aquí está el error en NA Porque no se convierte a "no constest".
Junté divorsiada, separada y viuda
```{r}
ile <- ile %>% 
  mutate(edocivil_descripcion2 = case_when(
    edocivil_descripcion == "SOLTERA" ~ "soltera",
    edocivil_descripcion == "VIUDA" ~ "separada",
    edocivil_descripcion == "UNION LIBRE" ~ "u libre", 
    edocivil_descripcion == "CASADA" ~ "casada",
    edocivil_descripcion == "SEPARADA" ~ "separada", 
    edocivil_descripcion== "DIVORCIADA" ~ "separada", 
    edocivil_descripcion== "<NA>" ~ "ninguna"
    ))
```

Sacar el porcentaje aparte porque es una variable escrita en texto. 
Es edocivil_descripcion2 porque el nombre de las variables ya están abreviadas. 
```{r}
ile %>% 
  select(edocivil_descripcion2) %>% 
   count(edocivil_descripcion2) %>% 
  mutate(perc = n / nrow(ile)) -> ile_edocivil
```

Gráfica de barras
```{r}
ggplot(ile, aes(x =edocivil_descripcion2)) +
  geom_bar(width = 0.4, fill=rgb(0.1,0.3,0.5,0.7), aes(y = (..count..)/sum(..count..))) +
  scale_x_discrete("estado civil") +     # configuración eje X (etiqueta del eje)
  scale_y_continuous("Porcentaje",labels=scales::percent) + #Configuración eje y
  labs(title = "Estado civil de usuarias de ILE",
       subtitle = "Frecuencia relativa de la variable Estadocivil")
```

No sale con colores. 
```{r}
ggplot(ile, aes(x =edocivil_descripcion2)) +
  geom_bar(width = 0.4, fill=rgb(0.1,0.3,0.5,0.7), aes(y = (..count..)/sum(..count..))) +
  scale_x_discrete("estado civil") +     # configuración eje X (etiqueta del eje)
  scale_y_continuous("Porcentaje",labels=scales::percent) + #Configuración eje y
scale_fill_manual(values = c("casada" = "#cb997e",
                               "separada" = "#ddbea9",
                               "soltera" = "#ffe8d6",
                               "u libre" = "#b7b7a4",
                               "NA" = "#a5a58d",
                               "ninguna" = "#a5a58d"))
labs(title = "Estado civil de usuarias de ILE",
       subtitle = "Frecuencia relativa de la variable Estadocivil")
```

####ocupacion#######
con este comando abreviaré el nombre de las variables. 
No olvidar -- No dejar espacios en los nombres que están dentro de las comillas.
En la consola ver unique(ile$edocivil_descripcion) de esta forma ovy a ver si las varriables en efecto se convietieron. 
***Desde aquí está el error en NA Porque no se convierte a "no constest".
```{r}
ile <- ile %>% 
  mutate(ocupacion2 = case_when(
    ocupacion == "TRABAJADORA DEL HOGAR NO REMUNERADA" ~ "Hogar",
    ocupacion == "EMPLEADA" ~ "Empleada",
    ocupacion == "ESTUDIANTE" ~ "Estudiante", 
    ocupacion == "DESEMPLEADA" ~ "Desempleada",
    ocupacion == "NO ESPECIFICADO" ~ "no especificado", 
    ocupacion == "<NA>" ~ "ninguna"
    ))
```

Sacar el porcentaje aparte porque es una variable escrita en texto. 
Es ocupacion2 porque el nombre de las variables ya están abreviadas. 
```{r}
ile %>% 
  select(ocupacion2) %>% 
   count(ocupacion2) %>% 
  mutate(perc = n / nrow(ile)) -> ile_ocup
```
Gráfica de barras

```{r}
ggplot(ile, aes(x =ocupacion2)) +
  geom_bar(width = 0.4, fill=rgb(0.1,0.3,0.5,0.7), aes(y = (..count..)/sum(..count..))) +
  scale_x_discrete("ocupacion") +     # configuración eje X (etiqueta del eje)
  scale_y_continuous("Porcentaje",labels=scales::percent) + #Configuración eje y
  labs(title = "ocupacion de usuarias de ILE",
       subtitle = "Frecuencia relativa de la variable ocupacion2")
```

#####nhijos######
unique(ile$nhijos)
¿Cómo le hago para que aparesca el número de hijos? 
```{r}
ile %>%
  drop_na(nhijos) %>% 
  ggplot(aes(x = nhijos)) + 
  geom_histogram(aes(y =..density..), breaks = seq(0, 10, by = 1), 
                 color = "#88398A", fill = "#88398A", alpha = 0.8) +
  scale_x_continuous(n.breaks = 10) +
   labs(title = "Número de mujeres que optaron por una ILE, 2016-2020", x= "Hijos", y = "Densidad") +
  theme_classic()
```
otro
```{r}
ggplot(ile, aes(x = nhijos)) +
  geom_density() +
  scale_y_continuous("Densidad") +
  scale_x_continuous("nhijos") +
  labs(title = "Histograma de densidad 3",
       subtitle = "Forma de la distribución de la variable nhijos")
```

nhijos
```{r}
ggplot(ile, aes(x = nhijos)) +
  geom_bar(width = 0.4, fill=rgb(0.1,0.3,0.5,0.7), aes(y = (..count..)/sum(..count..))) +
  scale_x_discrete("nhijos") +     # configuración eje X (etiqueta del eje)
  scale_y_continuous("Porcentaje",labels=scales::percent) + #Configuración eje y
  labs(title = "Gráfico de barras 4",
       subtitle = "Frecuencia relativa de la variable nhijos")
```


#######anticonceptivo###########

con este comando abreviaré el nombre de las variables. 
No olvidar -- No dejar espacios en los nombres que están dentro de las comillas.
En la consola ver unique(ile$anticonceptivo) de esta forma ovy a ver si las varriables en efecto se convietieron. 
***Desde aquí está el error en NA Porque no se convierte a "no constest".
```{r}
ile <- ile %>% 
 mutate(anticonceptivo2 = case_when(
    anticonceptivo == "NINGUNO" ~ "ninguno",
    anticonceptivo == "DIU" ~ "DIU",
    anticonceptivo == "PASTILLA ANTICONCEPTIVA" ~ "Pastillas", 
    anticonceptivo == "PARCHES" ~ "Parche",
    anticonceptivo == "PASTILLA DE EMERGENCIA" ~ "PAE", 
    anticonceptivo == "IMPLANTE SUBDERMICO" ~ "Implante", 
    anticonceptivo == "CONDON" ~ "condón",
    anticonceptivo == "LIGADURA DE TROMPAS" ~ "OBT",
    anticonceptivo == "CONDON + DIU" ~ "combinado barrera",
    anticonceptivo == "INYECCION + LIGADURA DE TROMPAS" ~ "combinado hormonal",
    anticonceptivo == "ANILLO VAGINAL" ~ "anillo",
    anticonceptivo == "CONDON + IMPLANTE" ~ "combinado barrera",
    anticonceptivo == "VASECTOMIA" ~ "vasectomía",
    anticonceptivo == "CONDON + PASTILLA ANTICONCEPTIVA" ~ "combinado barrera",
    anticonceptivo == "CONDON + INYECCION" ~ "combinado barrera",
    anticonceptivo == "INYECCION + DIU" ~ "combinado hormonal",
    anticonceptivo == "CONDON + PARCHE" ~ "combinado barrera",
    anticonceptivo == "PASTILLA DE EMERGENCIA + INYECCION" ~ "combinado hormonal",
    anticonceptivo == "PASTILLA DE EMERGENCIA + PARCHES" ~ "combinado hormonal",
    anticonceptivo == "<NA>" ~ "no contesto")) 
```

Sacar el porcentaje aparte porque es una variable escrita en texto. 
Es nivel_edu2 porque el nombre de las variables ya están abreviadas. 

```{r}
ile %>% 
  select(anticonceptivo2) %>% 
   count(anticonceptivo2) %>% 
  mutate(perc = n / nrow(ile)) -> ile_antic2
```

Gráfica 
```{r}
ggplot(ile, aes(x =anticonceptivo2)) +
  geom_bar(width = 0.4, fill=rgb(0.1,0.3,0.5,0.7), aes(y = (..count..)/sum(..count..))) +
  scale_x_discrete("anticonceptivo2") +     # configuración eje X (etiqueta del eje)
  scale_y_continuous("Porcentaje",labels=scales::percent) + #Configuración eje y
  labs(title = "Métodos anticonceptivos de usuarias de ILE",
       subtitle = "Frecuencia relativa de la variable anticonceptivos2")
```

Cambie el nombre las variables x tipo de método (hormonal, barrera, permanente)
```{r}
ile <- ile %>% 
 mutate(anticonceptivo2 = case_when(
    anticonceptivo == "NINGUNO" ~ "ninguno",
    anticonceptivo == "DIU" ~ "barrera",
    anticonceptivo == "PASTILLA ANTICONCEPTIVA" ~ "hormonal", 
    anticonceptivo == "PARCHES" ~ "hormonal",
    anticonceptivo == "PASTILLA DE EMERGENCIA" ~ "hormonal", 
    anticonceptivo == "IMPLANTE SUBDERMICO" ~ "hormonal", 
    anticonceptivo == "CONDON" ~ "barrera",
    anticonceptivo == "LIGADURA DE TROMPAS" ~ "permanente",
    anticonceptivo == "CONDON + DIU" ~ "combinado",
    anticonceptivo == "INYECCION + LIGADURA DE TROMPAS" ~ "combinado",
    anticonceptivo == "ANILLO VAGINAL" ~ "hormonal",
    anticonceptivo == "CONDON + IMPLANTE" ~ "combinado",
    anticonceptivo == "VASECTOMIA" ~ "permanente",
    anticonceptivo == "CONDON + PASTILLA ANTICONCEPTIVA" ~ "combinado",
    anticonceptivo == "CONDON + INYECCION" ~ "combinado",
    anticonceptivo == "INYECCION + DIU" ~ "combinado",
    anticonceptivo == "CONDON + PARCHE" ~ "combinado",
    anticonceptivo == "PASTILLA DE EMERGENCIA + INYECCION" ~ "combinado",
    anticonceptivo == "PASTILLA DE EMERGENCIA + PARCHES" ~ "combinado",
    anticonceptivo == "<NA>" ~ "no contesto")) 
```

Sacar el porcentaje aparte porque es una variable escrita en texto. 
Es nivel_edu2 porque el nombre de las variables ya están abreviadas. 

```{r}
ile %>% 
  select(anticonceptivo2) %>% 
   count(anticonceptivo2) %>% 
  mutate(perc = n / nrow(ile)) -> ile_edu
```

Gráfica 
```{r}
ggplot(ile, aes(x =anticonceptivo2)) +
  geom_bar(width = 0.4, fill=rgb(0.1,0.3,0.5,0.7), aes(y = (..count..)/sum(..count..))) +
  scale_x_discrete("anticonceptivo2") +     # configuración eje X (etiqueta del eje)
  scale_y_continuous("Porcentaje",labels=scales::percent) + #Configuración eje y
  labs(title = "Métodos anticonceptivos de usuarias de ILE",
       subtitle = "Frecuencia relativa de la variable anticonceptivos2")
```




